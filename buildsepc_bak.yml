version: 0.2 
env:
  secrets-manager:
    LIQUIBASE_DEV_URL: LIQUIBASE_DEV:URL
    LIQUIBASE_DEV_USERNAME: LIQUIBASE_DEV:USERNAME
    LIQUIBASE_DEV_PASSWORD: LIQUIBASE_DEV:PASSWORD
    LIQUIBASE_TESTING_URL: LIQUIBASE_TESTING:URL
    LIQUIBASE_TESTING_USERNAME: LIQUIBASE_TESTING:USERNAME
    LIQUIBASE_TESTING_PASSWORD: LIQUIBASE_TESTING:PASSWORD
phases:
  install:
    runtime-versions:
      java: corretto11
  build:
    commands:
      - echo "Comparing databases DEV to Testing"
      - liquibase --changelog-file=codebuild-$CODEBUILD_BUILD_NUMBER.xml\
                  --url="$LIQUIBASE_DEV_URL"\
                  --username=$LIQUIBASE_DEV_USERNAME\
                  --password=$LIQUIBASE_DEV_PASSWORD\
                  --referenceUrl="$LIQUIBASE_TESTING_URL"\
                  --referenceUsername=$LIQUIBASE_TESTING_USERNAME\
                  --referencePassword=$LIQUIBASE_TESTING_PASSWORD\
                  diff-changelog
artifacts:
  files:
    - codebuild-$CODEBUILD_BUILD_NUMBER.xml